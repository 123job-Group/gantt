{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./sources/ext/undo.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","gantt","config","undo_steps","undo","redo","this","_undo","getUndoStack","_undoStack","getRedoStack","_redoStack","clearUndoStack","clearRedoStack","undo_types","link","task","undo_actions","update","remove","add","move","maxSteps","undo_enabled","redo_enabled","_push","stack","action","commands","length","event","callEvent","push","shift","_pop","pop","_reorderCommands","weights","any","actionWeights","sort","a","b","entity","type","oldValue","parent","$index","weightA","updateConfigs","_applyAction","invert","copy","command","entities","actions","methods","isExists","batchUpdate","method","check","id","logAction","slice","revert","inverseCommands","load","clear","assert","monitor","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","isMoveEventsIgnored","toggleIgnoreMoveEvents","newValue","startIgnore","stopIgnore","startBatchAction","timeout","clearTimeout","setTimeout","stopBatchAction","_storeCommand","_storeEntityCommand","obj","old","actionType","entityType","_storeTaskCommand","getInitialTask","_storeLinkCommand","getInitialLink","onTaskAdded","onTaskUpdated","onTaskMoved","onTaskDeleted","_nestedTasks","children","_nestedLinks","childrenLinks","onLinkAdded","onLinkUpdated","onLinkDeleted","_initialTasks","_getLinks","$source","concat","$target","setNestedTasks","taskIds","tasks","linkIds","getTask","setInitialTask","uniqueLinks","links","setInitialLink","getTaskIndex","setInitialTaskObject","clearInitialTasks","_initialLinks","getLink","noTrack","onBeforeUndo","onBeforeRedo","attachEvent","batchActions","store","eachTask","child","deleteCacheCooldown","saveInitialAll","nested","ext","inlineEditors","state","datastore","getDatastore","getMoveObjectByTaskId","updTask","oldId","newId","changeTaskCommandId","updLink","oldTaskId","newTaskId","source","target","changeLinkCommandId","updateTasksIds","log","entry","j","updateLinksIds","tindex","e"],"mappings":"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","file":"ext/dhtmlxgantt_undo.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/codebase/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 185);\n","gantt.config.undo_steps = 10;\r\ngantt.config.undo = true;\r\ngantt.config.redo = true;\r\n\r\ngantt.undo = function(){\r\n\tthis._undo.undo();\r\n};\r\n\r\ngantt.getUndoStack = function(){\r\n\treturn this._undo._undoStack;\r\n};\r\n\r\ngantt.getRedoStack = function(){\r\n\treturn this._undo._redoStack;\r\n};\r\n\r\ngantt.clearUndoStack = function(){\r\n\tthis._undo._undoStack = [];\r\n};\r\n\r\ngantt.clearRedoStack = function(){\r\n\tthis._undo._redoStack = [];\r\n};\r\n\r\ngantt.redo = function(){\r\n\tthis._undo.redo();\r\n};\r\n\r\n/**\r\n * entities that require different processing for undoing-redoing changes\r\n * @type {{link: string, task: string}}\r\n */\r\ngantt.config.undo_types = {\r\n\tlink: \"link\",\r\n\ttask: \"task\"\r\n};\r\n\r\n/**\r\n * types of traced actions\r\n * @type {{update: string, remove: string, add: string}}\r\n */\r\ngantt.config.undo_actions = {\r\n\tupdate: \"update\",\r\n\tremove: \"remove\", // remove item from datastore\r\n\tadd: \"add\",\r\n\tmove: \"move\" // move task in grid\r\n};\r\n\r\ngantt._undo = {\r\n\t_undoStack:[],\r\n\t_redoStack:[],\r\n\tmaxSteps:10,\r\n\tundo_enabled: true,\r\n\tredo_enabled: true,\r\n\t_push: function(stack, action){\r\n\t\tif(!action.commands.length)\r\n\t\t\treturn;\r\n\r\n\t\tvar event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\r\n\t\tif(gantt.callEvent(event, [action]) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// commands can be removed from event handler\r\n\t\tif(!action.commands.length)\r\n\t\t\treturn;\r\n\r\n\t\tstack.push(action);\r\n\t\twhile(stack.length > this.maxSteps){\r\n\t\t\tstack.shift();\r\n\t\t}\r\n\t\treturn action;\r\n\t},\r\n\t_pop:function(stack){\r\n\t\treturn stack.pop();\r\n\t},\r\n\r\n\t_reorderCommands: function(action){\r\n\t\t// firstly process tasks and only then links\r\n\t\t// in order to ensure links are added not earlier than their tasks\r\n\t\t// firstly to 'move' actions and only then updates\r\n\t\tvar weights = {any: 0, link:1, task:2};\r\n\t\tvar actionWeights = {move: 1, any:0};\r\n\t\taction.commands.sort(function(a, b){\r\n\t\t\tif(a.entity == \"task\" && b.entity == \"task\"){\r\n\t\t\t\tif(a.type != b.type){\r\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\r\n\t\t\t\t}else if(a.type == \"move\" && a.oldValue && b.oldValue && b.oldValue.parent == a.oldValue.parent) {\r\n\t\t\t\t\treturn a.$index - b.$index;\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn 0\r\n\t\t\t\t}\r\n\r\n\t\t\t}else{\r\n\t\t\t\tvar weightA = weights[a.entity] || weights.any;\r\n\t\t\t\tvar weightB = weights[b.entity] || weights.any;\r\n\t\t\t\treturn weightB - weightA;\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t},\r\n\tundo:function(){\r\n\t\tthis.updateConfigs();\r\n\t\tif(!this.undo_enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar action = this._pop(this._undoStack);\r\n\t\tif(action)\r\n\t\t\tthis._reorderCommands(action);\r\n\t\tif(gantt.callEvent(\"onBeforeUndo\", [action]) !== false){\r\n\t\t\tif(action){\r\n\r\n\t\t\t\tthis._applyAction(this.action.invert(action));\r\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\r\n\t},\r\n\r\n\tredo:function(){\r\n\t\tthis.updateConfigs();\r\n\t\tif(!this.redo_enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar action = this._pop(this._redoStack);\r\n\t\tif(action)\r\n\t\t\tthis._reorderCommands(action);\r\n\r\n\t\tif(gantt.callEvent(\"onBeforeRedo\", [action]) !== false){\r\n\t\t\tif(action){\r\n\t\t\t\tthis._applyAction(action);\r\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\r\n\t},\r\n\r\n\t_applyAction:function(action){\r\n\t\tvar command = null,\r\n\t\t\tentities = this.command.entity,\r\n\t\t\tactions = this.command.type;\r\n\r\n\t\tvar methods = {};\r\n\t\tmethods[entities.task] = {\r\n\t\t\tadd: \"addTask\",\r\n\t\t\tupdate: \"updateTask\",\r\n\t\t\tremove: \"deleteTask\",\r\n\t\t\tmove: \"moveTask\",\r\n\t\t\tisExists: \"isTaskExists\"\r\n\t\t};\r\n\t\tmethods[entities.link] = {\r\n\t\t\tadd: \"addLink\",\r\n\t\t\tupdate: \"updateLink\",\r\n\t\t\tremove: \"deleteLink\",\r\n\t\t\tisExists: \"isLinkExists\"\r\n\t\t};\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\tfor (var i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tcommand = action.commands[i];\r\n\t\t\t\tvar method = methods[command.entity][command.type],\r\n\t\t\t\t\tcheck = methods[command.entity][\"isExists\"];\r\n\r\n\t\t\t\tif (command.type == actions.add) {\r\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$index);\r\n\t\t\t\t} else if (command.type == actions.remove) {\r\n\t\t\t\t\tif (gantt[check](command.value.id))\r\n\t\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t} else if (command.type == actions.update) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value);\r\n\t\t\t\t} else if (command.type == actions.move) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value.$index, command.value.parent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t//storeUndo:\r\n\tlogAction: function(action){\r\n\t\tthis._push(this._undoStack, action);\r\n\t\tthis._redoStack = [];\r\n\t},\r\n\r\n\taction: {\r\n\t\tcreate: function(commands){\r\n\t\t\treturn {commands: commands ? commands.slice() : []};\r\n\t\t},\r\n\t\tinvert: function(action){\r\n\t\t\tvar revert = gantt.copy(action);\r\n\t\t\tvar commands = gantt._undo.command;\r\n\r\n\t\t\tfor(var i = 0; i < action.commands.length; i++){\r\n\t\t\t\tvar command = revert.commands[i] = commands.invert(revert.commands[i]);\r\n\t\t\t\tif(command.type == commands.type.update || command.type == commands.type.move){\r\n\t\t\t\t\tvar value = command.value;\r\n\t\t\t\t\tcommand.value = command.oldValue;\r\n\t\t\t\t\tcommand.oldValue = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn revert;\r\n\t\t}\r\n\t},\r\n\r\n\tcommand:{\r\n\t\tcreate: function(value, oldValue, type, entity){\r\n\t\t\treturn {\r\n\t\t\t\tentity:entity,\r\n\t\t\t\ttype:type,\r\n\t\t\t\tvalue:gantt.copy(value),\r\n\t\t\t\toldValue:gantt.copy(oldValue || value)\r\n\t\t\t};\r\n\t\t},\r\n\t\tinvert: function(command){\r\n\t\t\tvar revert = gantt.copy(command);\r\n\t\t\trevert.type = this.inverseCommands(command.type);\r\n\t\t\treturn revert;\r\n\t\t},\r\n\t\t// entities that require different processing for undoing-redoing changes\r\n\t\tentity:null,\r\n\r\n\t\t//types of traced actions\r\n\t\ttype:null,\r\n\t\tinverseCommands:function(command){\r\n\t\t\tswitch (command){\r\n\t\t\t\tcase this.type.update:\r\n\t\t\t\t\treturn this.type.update;\r\n\t\t\t\tcase this.type.remove:\r\n\t\t\t\t\treturn this.type.add;\r\n\t\t\t\tcase this.type.add:\r\n\t\t\t\t\treturn this.type.remove;\r\n\t\t\t\tcase this.type.load:\r\n\t\t\t\t\treturn this.type.clear;\r\n\t\t\t\tcase this.type.clear:\r\n\t\t\t\t\treturn this.type.load;\r\n\t\t\t\tcase this.type.move:\r\n\t\t\t\t\treturn this.type.move;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tmonitor: {\r\n\t\t_batchAction: null,\r\n\t\t_batchMode: false,\r\n\t\t_ignore: false,\r\n\t\t_ignoreMoveEvents: false,\r\n\t\tisMoveEventsIgnored: function() {\r\n\t\t\treturn this._ignoreMoveEvents;\r\n\t\t},\r\n\t\ttoggleIgnoreMoveEvents: function(newValue) {\r\n\t\t\tthis._ignoreMoveEvents = newValue || false;\r\n\t\t},\r\n\t\tstartIgnore: function(){\r\n\t\t\tthis._ignore = true;\r\n\t\t},\r\n\t\tstopIgnore: function(){\r\n\t\t\tthis._ignore = false;\r\n\t\t},\r\n\t\tstartBatchAction : function(){\r\n\t\t\t// try catching updates made from event handlers using timeout\r\n\t\t\tif(this.timeout){\r\n\t\t\t\tclearTimeout(this.timeout);\r\n\t\t\t}\r\n\t\t\tthis.timeout = setTimeout(function(){\r\n\t\t\t\tgantt._undo.monitor.stopBatchAction();\r\n\t\t\t}, 10);\r\n\r\n\r\n\t\t\tif(this._ignore || this._batchMode)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis._batchMode = true;\r\n\t\t\tthis._batchAction = gantt._undo.action.create();\r\n\t\t},\r\n\t\tstopBatchAction: function(){\r\n\t\t\tif(this._ignore)\r\n\t\t\t\treturn;\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tif(this._batchAction){\r\n\t\t\t\tundo.logAction(this._batchAction);\r\n\t\t\t}\r\n\t\t\tthis._batchMode = false;\r\n\t\t\tthis._batchAction = null;\r\n\t\t},\r\n\r\n\t\t_storeCommand: function(command){\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tundo.updateConfigs();\r\n\r\n\t\t\tif(!undo.undo_enabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(this._batchMode){\r\n\t\t\t\tthis._batchAction.commands.push(command);\r\n\t\t\t}else{\r\n\t\t\t\tvar action = undo.action.create([command]);\r\n\t\t\t\tundo.logAction(action);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_storeEntityCommand: function(obj, old, actionType, entityType){\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tvar command = undo.command.create(obj, old, actionType, entityType);\r\n\t\t\tthis._storeCommand(command);\r\n\t\t},\r\n\t\t_storeTaskCommand: function(obj, type){\r\n\t\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, gantt._undo.command.entity.task);\r\n\t\t},\r\n\t\t_storeLinkCommand: function(obj, type){\r\n\t\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, gantt._undo.command.entity.link);\r\n\t\t},\r\n\t\tonTaskAdded:function(task){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.add);\r\n\t\t},\r\n\t\tonTaskUpdated:function(task){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.update);\r\n\t\t},\r\n\t\tonTaskMoved: function(task){\r\n\t\t\tif (!this._ignore) {\r\n\t\t\t\tthis._storeEntityCommand(\r\n\t\t\t\t\ttask,\r\n\t\t\t\t\tthis.getInitialTask(task.id),\r\n\t\t\t\t\tgantt._undo.command.type.move,\r\n\t\t\t\t\tgantt._undo.command.entity.task\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTaskDeleted: function(task){\r\n\t\t\tif(!this._ignore){\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.remove);\r\n\t\t\t\tif(this._nestedTasks[task.id]){\r\n\t\t\t\t\tvar children = this._nestedTasks[task.id];\r\n\t\t\t\t\tfor(var i = 0; i < children.length; i++){\r\n\t\t\t\t\t\tthis._storeTaskCommand(children[i], gantt._undo.command.type.remove);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(this._nestedLinks[task.id]){\r\n\t\t\t\t\tvar childrenLinks = this._nestedLinks[task.id];\r\n\t\t\t\t\tfor(var i = 0; i < childrenLinks.length; i++){\r\n\t\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], gantt._undo.command.type.remove);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonLinkAdded: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.add);\r\n\t\t},\r\n\t\tonLinkUpdated: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.update);\r\n\t\t},\r\n\t\tonLinkDeleted: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.remove);\r\n\t\t},\r\n\t\t_initialTasks:{},\r\n\t\t_nestedTasks:{},\r\n\t\t_nestedLinks:{},\r\n\t\t_getLinks: function(task){\r\n\t\t\treturn task.$source.concat(task.$target);\r\n\t\t},\r\n\t\tsetNestedTasks: function(id, taskIds){\r\n\t\t\tvar task = null,\r\n\t\t\t\ttasks = [],\r\n\t\t\t\tlinkIds = this._getLinks(gantt.getTask(id));\r\n\r\n\t\t\tfor(var i = 0; i < taskIds.length; i++){\r\n\t\t\t\ttask = this.setInitialTask(taskIds[i]);\r\n\r\n\t\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\r\n\r\n\r\n\t\t\t\ttasks.push(task);\r\n\t\t\t}\r\n\r\n\t\t\tvar uniqueLinks = {};\r\n\t\t\tfor(var i = 0; i < linkIds.length; i++){\r\n\t\t\t\tuniqueLinks[linkIds[i]] = true;\r\n\t\t\t}\r\n\t\t\tvar links = [];\r\n\t\t\tfor(var i in uniqueLinks){\r\n\t\t\t\tlinks.push(this.setInitialLink(i));\r\n\t\t\t}\r\n\t\t\tthis._nestedTasks[id] = tasks;\r\n\t\t\tthis._nestedLinks[id] = links;\r\n\t\t},\r\n\t\tsetInitialTask: function(id){\r\n\t\t\tif (!this._initialTasks[id] || !this._batchMode) {\r\n\t\t\t\tvar task = gantt.copy(gantt.getTask(id));\r\n\t\t\t\ttask.$index = gantt.getTaskIndex(id);\r\n\t\t\t\tthis.setInitialTaskObject(id, task);\r\n\t\t\t}\r\n\t\t\treturn this._initialTasks[id];\r\n\t\t},\r\n\t\tgetInitialTask: function(id){\r\n\t\t\treturn this._initialTasks[id];\r\n\t\t},\r\n\t\tclearInitialTasks: function(){\r\n\t\t\tthis._initialTasks = {};\r\n\t\t},\r\n\t\tsetInitialTaskObject: function(id, object) {\r\n\t\t\tthis._initialTasks[id] = object;\r\n\t\t},\r\n\r\n\t\t_initialLinks:{},\r\n\t\tsetInitialLink: function(id){\r\n\t\t\tif(!this._initialLinks[id] || !this._batchMode)\r\n\t\t\t\tthis._initialLinks[id] = gantt.copy(gantt.getLink(id));\r\n\r\n\t\t\treturn this._initialLinks[id];\r\n\t\t},\r\n\t\tgetInitialLink: function(id){\r\n\t\t\treturn this._initialLinks[id];\r\n\t\t}\r\n\t}\r\n\r\n\r\n};\r\ngantt._undo.updateConfigs = function(){\r\n\tgantt._undo.maxSteps = gantt.config.undo_steps;\r\n\tgantt._undo.command.entity = gantt.config.undo_types;\r\n\tgantt._undo.command.type = gantt.config.undo_actions;\r\n\tgantt._undo.undo_enabled = !!gantt.config.undo;\r\n\tgantt._undo.redo_enabled = (!!gantt.config.undo) && (!!gantt.config.redo);\r\n};\r\n\r\n\r\n(function(){\r\n\r\n\tvar monitor = gantt._undo.monitor;\r\n\r\n\tvar noTrack = {\r\n\t\t\"onBeforeUndo\":\"onAfterUndo\",\r\n\t\t\"onBeforeRedo\": \"onAfterRedo\"\r\n\t};\r\n\tfor(var i in noTrack){\r\n\t\tgantt.attachEvent(i, function(){\r\n\t\t\tmonitor.startIgnore();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(noTrack[i], function(){\r\n\t\t\tmonitor.stopIgnore();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tvar batchActions = [\r\n\t\t\"onTaskDragStart\",\r\n\t\t\"onAfterTaskUpdate\",\r\n\t\t\"onAfterTaskDelete\",\r\n\t\t\"onBeforeBatchUpdate\"\r\n\t];\r\n\r\n\tfor(var i  = 0; i < batchActions.length; i++){\r\n\t\tgantt.attachEvent(batchActions[i], function(){\r\n\t\t\tmonitor.startBatchAction();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\tfunction store(id){\r\n\t\tmonitor.setInitialTask(id);\r\n\t\tgantt.eachTask(function(child){\r\n\t\t\tmonitor.setInitialTask(child.id);\r\n\t\t}, id);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDrag\", store);\r\n\tgantt.attachEvent(\"onLightbox\", store);\r\n\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", function(task){ store(task.id);  return true;});\r\n\r\n\tvar deleteCacheCooldown = null;\r\n\r\n\tfunction saveInitialAll(){\r\n\t\tif(!deleteCacheCooldown){\r\n\t\t\tdeleteCacheCooldown = setTimeout(function(){\r\n\t\t\t\tdeleteCacheCooldown = null;\r\n\t\t\t});\r\n\r\n\t\t\tmonitor.clearInitialTasks();\r\n\t\t\tgantt.eachTask(function(task){\r\n\t\t\t\tmonitor.setInitialTask(task.id);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id){\r\n\t\tstore(id);\r\n\t\tvar nested = [];\r\n\r\n\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\r\n\t\tsaveInitialAll();\r\n\r\n\t\tgantt.eachTask(function(task){\r\n\t\t\tnested.push(task.id);\r\n\t\t}, id);\r\n\t\tmonitor.setNestedTasks(id, nested);\r\n\t\treturn true;\r\n\t});\r\n\tif(gantt.ext.inlineEditors){\r\n\t\tgantt.ext.inlineEditors.attachEvent(\"onEditStart\", function(state){\r\n\t\t\tstore(state.id);\r\n\t\t});\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", function(id, task){\r\n\t\tmonitor.onTaskAdded(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterTaskUpdate\", function(id, task){\r\n\t\tmonitor.onTaskUpdated(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, task){\r\n\t\tmonitor.onTaskDeleted(task);\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onAfterLinkAdd\", function(id, task){\r\n\t\tmonitor.onLinkAdded(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterLinkUpdate\", function(id, task){\r\n\t\tmonitor.onLinkUpdated(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, task){\r\n\t\tmonitor.onLinkDeleted(task);\r\n\t});\r\n\r\n\tvar datastore = gantt.getDatastore(\"task\");\r\n\r\n\tdatastore.attachEvent(\"onBeforeItemMove\", function(id, parent, tindex){\r\n\t\tif (!monitor.isMoveEventsIgnored()) {\r\n\r\n\t\t\tsaveInitialAll();\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\r\n\tdatastore.attachEvent(\"onAfterItemMove\", function(id, parent, tindex){\r\n\t\tif (!monitor.isMoveEventsIgnored()) {\r\n\t\t\tmonitor.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onRowDragStart\", function(id, target, e) {\r\n\t\tmonitor.toggleIgnoreMoveEvents(true);\r\n\t\tsaveInitialAll();\r\n\t\treturn true;\r\n\t});\r\n\t\r\n\tgantt.attachEvent(\"onRowDragEnd\", function(id, target) {\r\n\t\tmonitor.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\tmonitor.toggleIgnoreMoveEvents();\r\n\t\treturn true;\r\n\t});\r\n\r\n\tfunction getMoveObjectByTaskId(id) {\r\n\t\treturn gantt.copy(gantt.getTask(id));\r\n\t}\r\n\r\n\tfunction updTask(task, oldId, newId){\r\n\t\tif(!task) return;\r\n\r\n\t\tif(task.id == oldId){\r\n\t\t\ttask.id = newId;\r\n\t\t}\r\n\r\n\t\tif(task.parent == oldId){\r\n\t\t\ttask.parent = newId;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction changeTaskCommandId(command, oldId, newId){\r\n\t\tupdTask(command.value, oldId, newId);\r\n\t\tupdTask(command.oldValue, oldId, newId);\r\n\t}\r\n\r\n\tfunction updLink(link, oldTaskId, newTaskId){\r\n\t\tif(!link) return;\r\n\t\tif(link.source == oldTaskId){\r\n\t\t\tlink.source = newTaskId;\r\n\t\t}\r\n\t\tif(link.target == oldTaskId){\r\n\t\t\tlink.target = newTaskId;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction changeLinkCommandId(command, oldId, newId){\r\n\t\tupdLink(command.value, oldId, newId);\r\n\t\tupdLink(command.oldValue, oldId, newId);\r\n\t}\r\n\r\n\tfunction updateTasksIds(log, oldId, newId) {\r\n\t\tvar undo = gantt._undo;\r\n\r\n\t\tfor (var i = 0; i < log.length; i++) {\r\n\t\t\tvar entry = log[i];\r\n\t\t\tfor (var j = 0; j < entry.commands.length; j++) {\r\n\t\t\t\tif (entry.commands[j].entity == undo.command.entity.task) {\r\n\t\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t\t} else if (entry.commands[j].entity == undo.command.entity.link) {\r\n\t\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateLinksIds(log, oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\r\n\t\tfor (var i = 0; i < log.length; i++) {\r\n\t\t\tvar entry = log[i];\r\n\t\t\tfor (var j = 0; j < entry.commands.length; j++) {\r\n\t\t\t\tvar command = entry.commands[j];\r\n\t\t\t\tif (command.entity == undo.command.entity.link) {\r\n\t\t\t\t\tif(command.value && command.value.id == oldId){\r\n\t\t\t\t\t\tcommand.value.id = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(command.oldValue && command.oldValue.id == oldId){\r\n\t\t\t\t\t\tcommand.oldValue.id = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\t\tupdateTasksIds(undo._undoStack,oldId, newId);\r\n\t\tupdateTasksIds(undo._redoStack,oldId, newId);\r\n\t});\r\n\tgantt.attachEvent(\"onLinkIdChange\", function(oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\t\tupdateLinksIds(undo._undoStack,oldId, newId);\r\n\t\tupdateLinksIds(undo._redoStack,oldId, newId);\r\n\t});\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tgantt._undo.updateConfigs();\r\n\t});\r\n})();\r\n"],"sourceRoot":""}